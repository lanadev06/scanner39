<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–¢–µ—Å—Ç PWA ScannerOGP</title>
        <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        </style>
    </head>
    <body>
        <h1>üß™ –¢–µ—Å—Ç PWA ScannerOGP</h1>
        <div class="test-section">
            <h3>üì± –ü—Ä–æ–≤–µ—Ä–∫–∞ PWA —Ñ—É–Ω–∫—Ü–∏–π</h3>
            <button class="btn-primary" onclick="checkPWAStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å PWA</button>
            <button class="btn-success" onclick="installPWA()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PWA</button>
            <button class="btn-danger" onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
            <div id="pwa-status"></div>
        </div>
        <div class="test-section">
            <h3>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker</h3>
            <div id="sw-status"></div>
        </div>
        <div class="test-section">
            <h3>üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ Manifest</h3>
            <div id="manifest-status"></div>
        </div>
        <div class="test-section">
            <h3>üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞</h3>
            <div id="offline-status"></div>
        </div>
        <script>
        let deferredPrompt;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ PWA
        function checkPWAStatus() {
            const status = document.getElementById('pwa-status');
            let html = '<h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</h4>';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker
            if ('serviceWorker' in navigator) {
                html += '<p>‚úÖ Service Worker –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>';
            } else {
                html += '<p>‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Manifest
            if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
                html += '<p>‚úÖ PWA –∑–∞–ø—É—â–µ–Ω–æ –≤ standalone —Ä–µ–∂–∏–º–µ</p>';
            } else {
                html += '<p>‚ÑπÔ∏è PWA –∑–∞–ø—É—â–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                html += '<p>‚úÖ PWA —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</p>';
            } else {
                html += '<p>‚ÑπÔ∏è PWA –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (–º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)</p>';
            }
            
            status.innerHTML = html;
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª —É—Å—Ç–∞–Ω–æ–≤–∫—É PWA');
                    }
                    deferredPrompt = null;
                });
            } else {
                alert('PWA —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
        async function clearCache() {
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => caches.delete(name)));
                    alert('–ö—ç—à –æ—á–∏—â–µ–Ω!');
                    checkPWAStatus();
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∫—ç—à–∞: ' + error.message);
                }
            } else {
                alert('–ö—ç—à –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker
        async function checkServiceWorker() {
            const status = document.getElementById('sw-status');
            let html = '<h4>–°—Ç–∞—Ç—É—Å Service Worker:</h4>';
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        html += '<p>‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</p>';
                        html += '<p>–°–æ—Å—Ç–æ—è–Ω–∏–µ: ' + registration.active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω' + '</p>';
                        html += '<p>–û–±–ª–∞—Å—Ç—å: ' + registration.scope + '</p>';
                    } else {
                        html += '<p>‚ö†Ô∏è Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</p>';
                    }
                } catch (error) {
                    html += '<p>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ SW: ' + error.message + '</p>';
                }
            } else {
                html += '<p>‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>';
            }
            
            status.innerHTML = html;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Manifest
        async function checkManifest() {
            const status = document.getElementById('manifest-status');
            let html = '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ Manifest:</h4>';
            
            try {
                const response = await fetch('/manifest.json');
                if (response.ok) {
                    const manifest = await response.json();
                    html += '<p>‚úÖ Manifest –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ</p>';
                    html += '<p>–ù–∞–∑–≤–∞–Ω–∏–µ: ' + manifest.name + '</p>';
                    html += '<p>–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: ' + manifest.short_name + '</p>';
                    html += '<p>–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: ' + manifest.display + '</p>';
                    html += '<p>–ò–∫–æ–Ω–∫–∏: ' + manifest.icons.length + ' —à—Ç.</p>';
                } else {
                    html += '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ manifest.json</p>';
                }
            } catch (error) {
                html += '<p>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ manifest: ' + error.message + '</p>';
            }
            
            status.innerHTML = html;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
        function checkOfflineMode() {
            const status = document.getElementById('offline-status');
            let html = '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞:</h4>';
            
            if (navigator.onLine) {
                html += '<p>‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–Ω–ª–∞–π–Ω</p>';
            } else {
                html += '<p>üåê –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Ñ–ª–∞–π–Ω</p>';
            }
            
            html += '<p>–°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: ' + (navigator.connection ? navigator.connection.effectiveType : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞') + '</p>';
            
            status.innerHTML = html;
        }
        
        // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('PWA –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å');
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('PWA —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            deferredPrompt = null;
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            checkServiceWorker();
            checkManifest();
            checkOfflineMode();
        });
        
        // –°–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        window.addEventListener('online', () => {
            checkOfflineMode();
        });
        
        window.addEventListener('offline', () => {
            checkOfflineMode();
        });
        </script>
    </body>
</html>
