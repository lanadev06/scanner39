<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–¢–µ—Å—Ç PWA - Scanner39</title>
        <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .icon-preview { width: 64px; height: 64px; margin: 10px; display: inline-block; }
        </style>
    </head>
    <body>
        <h1>üß™ –¢–µ—Å—Ç PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h1>
        <div class="test-section">
            <h2>üì± –ü—Ä–æ–≤–µ—Ä–∫–∞ PWA –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</h2>
            <div id="pwa-status"></div>
            <button onclick="checkPWAStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å PWA</button>
            <button onclick="checkServiceWorker()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Service Worker</button>
            <button onclick="checkManifest()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Manifest</button>
            <button onclick="checkOffline()">–¢–µ—Å—Ç –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞</button>
        </div>
        <div class="test-section">
            <h2>üéØ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA</h2>
            <div id="install-status"></div>
            <button id="installBtn" style="display:none;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <p>
                <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong>
            </p>
            <ul>
                <li>
                    <strong>Chrome/Edge:</strong> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
                </li>
                <li>
                    <strong>Android:</strong> –ú–µ–Ω—é ‚Üí "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"
                </li>
                <li>
                    <strong>iOS:</strong> Safari ‚Üí –ü–æ–¥–µ–ª–∏—Ç—å—Å—è ‚Üí "–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª"
                </li>
            </ul>
        </div>
        <div class="test-section">
            <h2>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∫–æ–Ω–æ–∫</h2>
            <div id="icon-status"></div>
            <div id="icon-preview"></div>
        </div>
        <div class="test-section">
            <h2>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ</h2>
            <div id="browser-info"></div>
        </div>
        <div class="test-section">
            <h2>üöÄ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–∫–∞–Ω–µ—Ä—É</h2>
            <a href="index.html" style="text-decoration: none;">
                <button style="background: #28a745;">üì∑ –û—Ç–∫—Ä—ã—Ç—å —Å–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤</button>
            </a>
        </div>
        <script>
        let deferredPrompt;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ PWA —Å—Ç–∞—Ç—É—Å–∞
        function checkPWAStatus() {
            const statusDiv = document.getElementById('pwa-status');
            let html = '';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Service Workers
            if ('serviceWorker' in navigator) {
                html += '<div class="status success">‚úÖ Service Workers –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</div>';
            } else {
                html += '<div class="status error">‚ùå Service Workers –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</div>';
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Manifest
            if ('manifest' in document.createElement('link')) {
                html += '<div class="status success">‚úÖ Web App Manifest –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</div>';
            } else {
                html += '<div class="status error">‚ùå Web App Manifest –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</div>';
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                html += '<div class="status success">‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤ standalone —Ä–µ–∂–∏–º–µ</div>';
            } else {
                html += '<div class="status info">‚ÑπÔ∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</div>';
            }

            statusDiv.innerHTML = html;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker
        async function checkServiceWorker() {
            const statusDiv = document.getElementById('pwa-status');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        statusDiv.innerHTML += '<div class="status success">‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</div>';
                        statusDiv.innerHTML += `<div class="status info">‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å: ${registration.active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ –∞–∫—Ç–∏–≤–µ–Ω'}</div>`;
                    } else {
                        statusDiv.innerHTML += '<div class="status warning">‚ö†Ô∏è Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω</div>';
                    }
                } catch (error) {
                    statusDiv.innerHTML += `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Manifest
        async function checkManifest() {
            const statusDiv = document.getElementById('pwa-status');
            
            try {
                const response = await fetch('manifest.json');
                if (response.ok) {
                    const manifest = await response.json();
                    statusDiv.innerHTML += '<div class="status success">‚úÖ Manifest –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ</div>';
                    statusDiv.innerHTML += `<div class="status info">‚ÑπÔ∏è –ù–∞–∑–≤–∞–Ω–∏–µ: ${manifest.name}</div>`;
                    statusDiv.innerHTML += `<div class="status info">‚ÑπÔ∏è –ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: ${manifest.short_name}</div>`;
                } else {
                    statusDiv.innerHTML += '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Manifest</div>';
                }
            } catch (error) {
                statusDiv.innerHTML += `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –¢–µ—Å—Ç –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞
        function checkOffline() {
            const statusDiv = document.getElementById('pwa-status');
            
            if (navigator.onLine) {
                statusDiv.innerHTML += '<div class="status info">‚ÑπÔ∏è –°–µ–π—á–∞—Å –æ–Ω–ª–∞–π–Ω</div>';
                statusDiv.innerHTML += '<div class="status info">‚ÑπÔ∏è –û—Ç–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞</div>';
            } else {
                statusDiv.innerHTML += '<div class="status success">‚úÖ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω</div>';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∫–æ–Ω–æ–∫
        function checkIcons() {
            const statusDiv = document.getElementById('icon-status');
            const previewDiv = document.getElementById('icon-preview');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º SVG –∏–∫–æ–Ω–∫—É
            const img = new Image();
            img.onload = function() {
                statusDiv.innerHTML = '<div class="status success">‚úÖ SVG –∏–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ</div>';
                previewDiv.innerHTML = '<img src="icon.svg" alt="PWA Icon" class="icon-preview">';
            };
            img.onerror = function() {
                statusDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SVG –∏–∫–æ–Ω–∫–∏</div>';
            };
            img.src = 'icon.svg';
        }

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
        function showBrowserInfo() {
            const infoDiv = document.getElementById('browser-info');
            infoDiv.innerHTML = `
                <div class="status info">
                    <strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> ${navigator.userAgent}<br>
                    <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${navigator.platform}<br>
                    <strong>–Ø–∑—ã–∫:</strong> ${navigator.language}<br>
                    <strong>–û–Ω–ª–∞–π–Ω:</strong> ${navigator.onLine ? '–î–∞' : '–ù–µ—Ç'}<br>
                    <strong>User Agent:</strong> ${navigator.userAgent}
                </div>
            `;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installBtn = document.getElementById('installBtn');
            installBtn.style.display = 'block';
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        document.getElementById('install-status').innerHTML = 
                            '<div class="status success">‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!</div>';
                    }
                    deferredPrompt = null;
                }
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            checkPWAStatus();
            checkIcons();
            showBrowserInfo();
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
                    })
                    .catch(error => {
                        console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                    });
            }
        });
        </script>
    </body>
</html>
