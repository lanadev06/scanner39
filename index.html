<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>ScannerOGP</title>
        <meta name="description" content="–°–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–≤ ScannerOGP –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤">
        <meta name="theme-color" content="#ff6b35">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="ScannerOGP">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="theme-color" content="#ff6b35">
        <meta name="msapplication-TileColor" content="#ff6b35">
        <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è Android -->
        <meta name="application-name" content="ScannerOGP">
        <meta name="msapplication-TileImage" content="scannerlogo.png">
        <meta name="msapplication-config" content="none">
        <!-- Android Chrome PWA -->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="mobile-web-app-title" content="ScannerOGP">
        <!-- Android WebView -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <link rel="icon" type="image/png" href="scannerlogo.png">
        <link rel="apple-touch-icon" href="scannerlogo.png">
        <link rel="manifest" href="manifest.json">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
*{margin:0;padding:0;box-sizing:border-box}
body{min-height:100vh;min-height:100dvh;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)}
body{font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;background:#f5f5f5;color:#333;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:20px}
.container{width:100%;max-width:600px;text-align:center;background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.1);padding:30px}
.header{margin-bottom:30px}
.logo{width:110px;margin:0 auto 20px;background:linear-gradient(135deg,#dfcec7 0%,#ffffff 100%);border-radius:15px;display:flex;align-items:center;justify-content:center;box-shadow:0 5px 15px rgba(255,107,53,.3)}
.control-panel .logo{width:80px;height:80px;margin:0 auto 0;transition:all .3s ease;margin-bottom:8px}
.logo-btn{border:none;background:none;cursor:pointer;transition:transform .3s ease;border-radius:15px;overflow:hidden}
.logo-btn:hover{transform:scale(1.05);box-shadow:0 8px 25px rgba(255,107,53,.4)}
.logo-btn:active{transform:scale(0.95)}
.logo-btn:focus{outline:2px solid #ff6b35;outline-offset:2px}
.navigation-menu{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);z-index:1000;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;transition:all .3s ease}
.menu-header{margin-bottom:40px;text-align:center}
.menu-header .logo{width:80px;height:80px;margin:0 auto 20px;box-shadow:0 8px 25px rgba(255,107,53,.4)}
.menu-items{display:flex;flex-direction:column;gap:12px;width:100%;max-width:350px}
.menu-item{padding:18px 24px;border:none;border-radius:16px;font-size:15px;font-weight:500;cursor:pointer;transition:all .3s ease;text-align:left;position:relative;overflow:hidden;background:rgba(255,255,255,.95);color:#333;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.menu-item::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:left .5s ease}
.menu-item:hover::before{left:100%}
.menu-item:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,0,0,.15);background:rgba(255,255,255,1)}
.menu-item:active{transform:translateY(0)}
.menu-item:focus{outline:2px solid #ff6b35;outline-offset:2px}
.menu-item-scan{border-left:4px solid #ff6b35}
.menu-item-manual{border-left:4px solid #ff6b35}
.menu-item-auth{border-left:4px solid #28a745}
.menu-item-list{border-left:4px solid #6c757d}
.menu-item-support{border-left:4px solid #007bff}
.menu-item-info{border-left:4px solid #dc3545}
.logo img{width:100%;height:100%;object-fit:contain;border-radius:15px;transition:all .3s ease}
.header h1{font-size:2.2em;margin-bottom:10px;color:#ff6b35;transition:all .3s ease}
.scanner-wrapper{display:flex;gap:20px;margin-bottom:20px;flex-direction:row;align-items:stretch}
.scanner-container{position:relative;width:65%;height:400px;background:#000;border-radius:15px;overflow:hidden;transition:all .3s ease}
#scannerRoot video,#scannerRoot canvas{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:1}
.scanner-frame{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  width:min(88%,380px);height:150px;border:4px solid #ff6b35;border-radius:12px;
  box-shadow:0 0 0 2000px rgba(0,0,0,.3);pointer-events:none;z-index:2;transition:all .3s ease}
.scanner-line{position:absolute;left:0;right:0;height:3px;background:#ff6b35;animation:scan 2s infinite ease-in-out;z-index:2;transition:all .3s ease}
@keyframes scan{0%,100%{top:10%}50%{top:90%}}
.scan-status{position:absolute;top:10px;left:10px;background:rgba(255,107,53,.9);color:#fff;padding:5px 10px;border-radius:5px;font-size:12px;z-index:3;transition:all .3s ease}
.controls{margin:0;display:flex;flex-direction:column;gap:20px;align-items:center;width:100%}
.control-panel{text-align:center;display:flex;flex-direction:column;justify-content:space-between;align-items:center;gap:15px;width:35%;flex-shrink:0;height:100%}

.result{position:relative;background:linear-gradient(135deg,#ff6b35 0%,#f7931e 100%);color:#fff;padding:25px;border-radius:15px;margin:25px 0;box-shadow:0 8px 25px rgba(255,107,53,.3);transition:all .3s ease;clear:both;overflow:hidden}
.result.actual{background:linear-gradient(135deg,#28a745 0%,#20c997 100%);box-shadow:0 8px 25px rgba(40,167,69,.3)}
.version-text{position:absolute;top:5px;right:10px;color:#fff;font-size:25px;font-weight:600}
.loading-overlay{position:absolute;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;border-radius:15px;z-index:5}
.loading-text{color:#fff;font-size:14px;font-weight:600;margin-top:10px;text-align:center}
.result-fields{display:flex;flex-direction:column;gap:15px}
.result-field{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.2);transition:all .3s ease}
.result-field:last-child{border-bottom:none}
.field-label{font-weight:600;font-size:12px;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3);transition:all .3s ease}
.field-value{font-size:12px;font-weight:700;color:#fff;text-shadow:1px 1px 2px rgba(0,0,0,.3);word-break:break-all;text-align:right;flex:1;margin-left:20px;transition:all .3s ease}

.status{margin:20px 0;font-style:italic;color:#666;font-size:1.1em;clear:both;transition:all .3s ease}
.zoom-controls{margin:0;text-align:center;transition:opacity .3s ease;overflow:hidden;flex:1;display:flex;flex-direction:column;justify-content:center;width:100%}
.zoom-label{margin-bottom:10px;font-weight:600;color:#333;font-size:1em}
.zoom-buttons{display:flex;flex-direction:column;justify-content:center;gap:8px;flex-wrap:nowrap;align-items:center;width:100%;margin:0 auto}
.zoom-btn{width:40px;height:40px;padding:0;font-size:18px;font-weight:bold;border-radius:8px;opacity:0.6;transition:all .2s ease;display:flex;align-items:center;justify-content:center;line-height:1;box-sizing:border-box;flex:0 0 40px;aspect-ratio:1/1;margin:1px 0}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.control-panel .btn{transition:all .3s ease;border-radius:8px;font-weight:600;margin:2px 0}
.control-panel .btn:hover{transform:scale(1.02);box-shadow:0 4px 12px rgba(0,0,0,.15)}
.control-panel .btn:active{transform:scale(0.98)}
.control-panel .btn:focus{outline:2px solid #ff6b35;outline-offset:2px}
.zoom-btn:hover:not(:disabled){opacity:1;transform:scale(1.05)}
.zoom-btn:disabled{opacity:0.3;cursor:not-allowed}
.zoom-btn:focus{outline:2px solid #ff6b35;outline-offset:2px}

.error{color:#ff6b6b;background:rgba(255,107,53,.1);padding:15px;border-radius:10px;margin:15px 0;border:2px solid #ff6b6b;transition:all .3s ease}
.footer{margin-top:30px;font-size:.9em;color:#999;transition:all .3s ease}

/* PWA –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º */
@media (display-mode: standalone) {
  body { padding: 0; }
  .container { border-radius: 0; max-width: 100%; }
  .scanner-wrapper { border-radius: 0; }
}

/* –°–∫—Ä—ã—Ç–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞ */
@media (display-mode: standalone), (display-mode: minimal-ui) {
  body { 
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }
}




/* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É */
@media (max-width:480px){
  .container{padding:15px}
  .scanner-wrapper{display:flex;flex-direction:row;gap:12px;align-items:stretch}
  .scanner-container{width:65%;height:280px;min-width:180px}
  .scanner-frame{width:90%;height:120px}
  .control-panel{width:35%;min-width:100px;height:280px;display:flex;flex-direction:column;justify-content:space-between;align-items:center;gap:12px;padding:15px 0}
  .control-panel .logo{width:50px;height:50px;margin-bottom:8px;flex-shrink:0}
  .control-panel .btn{width:90% !important;height:40px !important;font-size:0.9em;max-width:90px;margin:3px 0;flex-shrink:0}
  .zoom-controls{width:90%;flex-shrink:0}
  .zoom-controls .zoom-buttons{flex-direction:column;gap:10px;width:100%}
  .zoom-controls .zoom-btn{width:100%;height:32px;font-size:14px;margin:2px 0;flex-shrink:0}
  .header h1{font-size:1.6em;margin-bottom:8px}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width:360px){
  .scanner-wrapper{gap:8px;align-items:stretch}
  .scanner-container{width:62%;min-width:160px}
  .control-panel{width:38%;min-width:90px;gap:8px;padding:10px 0}
  .control-panel .logo{width:45px;height:45px;margin-bottom:6px;flex-shrink:0}
  .control-panel .btn{width:85% !important;height:35px !important;font-size:0.8em;max-width:80px;margin:2px 0;flex-shrink:0}
  .zoom-controls{width:85%;flex-shrink:0}
  .zoom-controls .zoom-buttons{gap:8px}
  .zoom-controls .zoom-btn{height:28px;font-size:12px;margin:2px 0;flex-shrink:0}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ –∏ —Å—Ä–µ–¥–Ω–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (min-width:481px) and (max-width:768px){
  .scanner-wrapper{gap:20px;align-items:stretch}
  .scanner-container{width:65%}
  .control-panel{width:35%;gap:18px;padding:20px 0}
  .control-panel .logo{width:70px;height:70px;margin-bottom:12px;flex-shrink:0}
  .control-panel .btn{width:95% !important;max-width:120px;margin:3px 0;flex-shrink:0}
  .zoom-controls{width:95%;flex-shrink:0}
  .zoom-controls .zoom-buttons{gap:12px}
}

/* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–∞ */
@media (max-width:600px){
  .scanner-wrapper{display:flex;flex-direction:row;align-items:stretch;gap:15px}
  .scanner-container{flex:1;min-width:0}
  .control-panel{flex-shrink:0;width:auto;min-width:120px;height:100%}
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–π –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
@media (max-width:400px){
  .container{padding:10px}
  .scanner-wrapper{gap:8px;align-items:stretch}
  .scanner-container{height:250px}
  .scanner-frame{width:85%;height:100px}
  .control-panel{height:250px;gap:10px;padding:12px 0}
  .control-panel .logo{width:45px;height:45px;margin-bottom:6px;flex-shrink:0}
  .control-panel .btn{width:85% !important;height:32px !important;font-size:0.8em;max-width:75px;margin:2px 0;flex-shrink:0}
  .zoom-controls{width:85%;flex-shrink:0}
  .zoom-controls .zoom-buttons{gap:8px}
  .zoom-controls .zoom-btn{height:24px;font-size:12px;margin:2px 0;flex-shrink:0}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:768px) and (orientation: landscape){
  .scanner-wrapper{gap:15px;align-items:stretch}
  .scanner-container{height:200px}
  .control-panel{height:200px;gap:10px;padding:12px 0}
  .control-panel .logo{width:50px;height:50px;margin-bottom:8px;flex-shrink:0}
  .control-panel .btn{height:35px !important;flex-shrink:0}
  .zoom-controls{flex-shrink:0}
  .zoom-controls .zoom-btn{height:28px;flex-shrink:0}
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
@media (max-width:480px){
  .control-panel .d-flex{justify-content:space-between;height:100%;padding:5px 0}
  .control-panel .logo{flex:0 0 auto}
  .control-panel .zoom-controls{flex:0 0 auto}
  .control-panel .btn{flex:0 0 auto}
}

@media (max-width:360px){
  .control-panel .d-flex{justify-content:space-between;height:100%;padding:3px 0}
}

/* –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width:768px){
  /* –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
  .scanner-wrapper{display:flex;flex-direction:row;align-items:stretch;gap:clamp(8px, 2vw, 20px)}
  .scanner-container{flex:1;min-width:0;height:clamp(250px, 60vh, 400px)}
  .control-panel{flex-shrink:0;width:clamp(100px, 35vw, 150px);height:100%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;gap:clamp(8px, 2vh, 15px);padding:clamp(8px, 2vh, 15px) 0}
  
  /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ª–æ–≥–æ—Ç–∏–ø–∞ */
  .control-panel .logo{width:clamp(45px, 12vw, 80px);height:clamp(45px, 12vw, 80px);flex-shrink:0;margin-bottom:clamp(4px, 1vh, 8px)}
  
  /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–Ω–æ–ø–æ–∫ */
  .control-panel .btn{width:clamp(80px, 90%, 130px) !important;height:clamp(35px, 8vh, 50px) !important;font-size:clamp(0.8em, 2.5vw, 1em);flex-shrink:0;margin:clamp(1px, 0.5vh, 3px) 0}
  
  /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ–º */
  .zoom-controls{width:clamp(80px, 90%, 130px);flex-shrink:0}
  .zoom-controls .zoom-buttons{flex-direction:column;gap:clamp(6px, 1.5vh, 10px);width:100%}
  .zoom-controls .zoom-btn{width:100%;height:clamp(24px, 6vh, 40px);font-size:clamp(12px, 3vw, 18px);flex-shrink:0;margin:clamp(1px, 0.5vh, 2px) 0}
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width:320px){
  .scanner-wrapper{gap:6px}
  .control-panel{width:clamp(80px, 38vw, 100px);gap:6px;padding:6px 0}
  .control-panel .logo{width:40px;height:40px;margin-bottom:4px}
  .control-panel .btn{height:32px !important;font-size:0.75em}
  .zoom-controls .zoom-btn{height:22px;font-size:11px}
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (min-width:321px) and (max-width:480px){
  .scanner-wrapper{gap:clamp(10px, 2.5vw, 15px)}
  .control-panel{width:clamp(110px, 35vw, 140px);gap:clamp(10px, 2.5vh, 15px);padding:clamp(10px, 2.5vh, 15px) 0}
  .control-panel .logo{width:clamp(50px, 13vw, 70px);height:clamp(50px, 13vw, 70px);margin-bottom:clamp(6px, 1.5vh, 10px)}
  .control-panel .btn{height:clamp(38px, 9vh, 45px) !important;font-size:clamp(0.85em, 2.8vw, 0.95em)}
  .zoom-controls .zoom-btn{height:clamp(28px, 7vh, 35px);font-size:clamp(13px, 3.5vw, 16px)}
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ –∏ –ø–ª–∞–Ω—à–µ—Ç–æ–≤ */
@media (min-width:481px) and (max-width:768px){
  .scanner-wrapper{gap:clamp(15px, 3vw, 25px)}
  .control-panel{width:clamp(130px, 35vw, 160px);gap:clamp(15px, 3vh, 20px);padding:clamp(15px, 3vh, 20px) 0}
  .control-panel .logo{width:clamp(60px, 15vw, 80px);height:clamp(60px, 15vw, 80px);margin-bottom:clamp(8px, 2vh, 12px)}
  .control-panel .btn{height:clamp(42px, 10vh, 50px) !important;font-size:clamp(0.9em, 3vw, 1em)}
  .zoom-controls .zoom-btn{height:clamp(32px, 8vh, 40px);font-size:clamp(14px, 4vw, 18px)}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏ */
@supports not (gap: clamp(8px, 2vw, 20px)){
  @media (max-width:768px){
    .scanner-wrapper{gap:15px}
    .control-panel{gap:12px;padding:12px 0}
    .control-panel .logo{margin-bottom:6px}
    .control-panel .btn{margin:2px 0}
    .zoom-controls .zoom-buttons{gap:8px}
    .zoom-controls .zoom-btn{margin:1px 0}
  }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –≤—ã—Å–æ–∫–∏–º DPI */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi){
  .control-panel .btn{font-weight:500}
  .zoom-controls .zoom-btn{font-weight:600}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –Ω–∏–∑–∫–∏–º DPI */
@media (-webkit-max-device-pixel-ratio: 1), (max-resolution: 96dpi){
  .control-panel .btn{font-weight:600}
  .zoom-controls .zoom-btn{font-weight:700}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —Å–µ–Ω—Å–æ—Ä–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º */
@media (hover: none) and (pointer: coarse){
  .control-panel .btn{min-height:44px;min-width:44px}
  .zoom-controls .zoom-btn{min-height:32px;min-width:32px}
  .control-panel .logo{min-height:48px;min-width:48px}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –±–µ–∑ —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ */
@media (hover: hover) and (pointer: fine){
  .control-panel .btn:hover{transform:scale(1.02)}
  .zoom-controls .zoom-btn:hover{opacity:1}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:768px) and (orientation: portrait){
  .scanner-container{height:clamp(280px, 70vh, 400px)}
  .control-panel{height:100%;gap:clamp(10px, 2.5vh, 18px)}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ª–∞–Ω–¥—à–∞—Ñ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:768px) and (orientation: landscape){
  .scanner-container{height:clamp(200px, 50vh, 300px)}
  .control-panel{height:100%;gap:clamp(8px, 2vh, 15px)}
  .control-panel .logo{width:clamp(40px, 10vw, 60px);height:clamp(40px, 10vw, 60px)}
  .control-panel .btn{height:clamp(32px, 7vh, 40px) !important}
  .zoom-controls .zoom-btn{height:clamp(24px, 6vh, 32px)}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (–ø–ª–∞–Ω—à–µ—Ç—ã –≤ –∞–ª—å–±–æ–º–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏) */
@media (min-width:769px) and (max-width:1024px){
  .scanner-wrapper{gap:clamp(20px, 4vw, 30px)}
  .scanner-container{width:65%;height:clamp(350px, 80vh, 450px)}
  .control-panel{width:35%;gap:clamp(18px, 3vh, 25px);padding:clamp(20px, 4vh, 30px) 0}
  .control-panel .logo{width:clamp(70px, 18vw, 90px);height:clamp(70px, 18vw, 90px)}
  .control-panel .btn{width:clamp(120px, 95%, 150px) !important;height:clamp(45px, 10vh, 55px) !important}
  .zoom-controls{width:clamp(120px, 95%, 150px)}
  .zoom-controls .zoom-btn{height:clamp(36px, 8vh, 44px)}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ viewport */
@media (max-width:768px) and (max-height:500px){
  .scanner-container{height:clamp(180px, 45vh, 250px)}
  .control-panel{gap:clamp(6px, 1.5vh, 12px);padding:clamp(6px, 1.5vh, 12px) 0}
  .control-panel .logo{width:clamp(35px, 9vw, 50px);height:clamp(35px, 9vw, 50px)}
  .control-panel .btn{height:clamp(28px, 6vh, 35px) !important}
  .zoom-controls .zoom-btn{height:clamp(20px, 5vh, 28px)}
}

@media (max-width:768px) and (min-height:800px){
  .scanner-container{height:clamp(350px, 75vh, 450px)}
  .control-panel{gap:clamp(15px, 3vh, 20px);padding:clamp(15px, 3vh, 20px) 0}
  .control-panel .logo{width:clamp(55px, 14vw, 75px);height:clamp(55px, 14vw, 75px)}
  .control-panel .btn{height:clamp(42px, 9vh, 50px) !important}
  .zoom-controls .zoom-btn{height:clamp(30px, 7vh, 38px)}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –æ—á–µ–Ω—å —É–∑–∫–∏–º–∏ —ç–∫—Ä–∞–Ω–∞–º–∏ */
@media (max-width:280px){
  .scanner-wrapper{gap:4px}
  .scanner-container{width:60%;min-width:120px}
  .control-panel{width:40%;min-width:70px;gap:4px;padding:4px 0}
  .control-panel .logo{width:35px;height:35px;margin-bottom:3px}
  .control-panel .btn{width:100% !important;height:30px !important;font-size:0.7em}
  .zoom-controls{width:100%}
  .zoom-controls .zoom-btn{height:20px;font-size:10px}
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media screen and (-webkit-min-device-pixel-ratio: 1) {
  /* –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞ –Ω–∞ Android */
  .control-panel .logo img{
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
  }
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è Android Chrome */
@media screen and (-webkit-min-device-pixel-ratio: 1) and (max-width:768px) {
  .control-panel .logo{
    -webkit-transform: translate3d(0,0,0);
    transform: translate3d(0,0,0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-perspective: 1000;
    perspective: 1000;
  }
  
  .control-panel .logo img{
    -webkit-transform: translate3d(0,0,0);
    transform: translate3d(0,0,0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    -webkit-filter: contrast(1.1) brightness(1.05);
    filter: contrast(1.1) brightness(1.05);
  }
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è Android WebView */
@media screen and (max-width:768px) {
  .control-panel .logo{
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
  
  .control-panel .logo img{
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞ –Ω–∞ Android */
@media screen and (max-width:768px) {
  .control-panel .logo{
    /* –£–ª—É—á—à–µ–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–∞ Android */
    -webkit-transform: translate3d(0,0,0);
    transform: translate3d(0,0,0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-perspective: 1000;
    perspective: 1000;
    /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–∞–∑–º—ã—Ç–∏—è */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* –£–ª—É—á—à–µ–Ω–∏–µ —á–µ—Ç–∫–æ—Å—Ç–∏ */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    image-rendering: pixelated;
  }
  
  .control-panel .logo img{
    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è */
    -webkit-transform: translate3d(0,0,0);
    transform: translate3d(0,0,0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    /* –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    image-rendering: pixelated;
    /* –§–∏–ª—å—Ç—Ä—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–µ—Ç–∫–æ—Å—Ç–∏ */
    -webkit-filter: contrast(1.1) brightness(1.05) saturate(1.1);
    filter: contrast(1.1) brightness(1.05) saturate(1.1);
    /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–∞–∑–º—ã—Ç–∏—è */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è Android —Å –≤—ã—Å–æ–∫–∏–º DPI */
@media screen and (-webkit-min-device-pixel-ratio: 2) and (max-width:768px) {
  .control-panel .logo img{
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    -webkit-filter: contrast(1.2) brightness(1.1) saturate(1.2);
    filter: contrast(1.2) brightness(1.1) saturate(1.2);
  }
}

/* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è Android —Å –Ω–∏–∑–∫–∏–º DPI */
@media screen and (-webkit-max-device-pixel-ratio: 1) and (max-width:768px) {
  .control-panel .logo img{
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    -webkit-filter: contrast(1.05) brightness(1.02) saturate(1.05);
    filter: contrast(1.05) brightness(1.02) saturate(1.05);
  }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:480px){
  .result{padding:20px;margin:20px 0}
  .result-fields{gap:12px}
  .result-field{padding:10px 0}
  .field-label{font-size:11px}
  .field-value{font-size:11px;margin-left:15px}
  .version-text{font-size:20px}
}

@media (max-width:360px){
  .result{padding:15px;margin:15px 0}
  .result-fields{gap:10px}
  .result-field{padding:8px 0}
  .field-label{font-size:10px}
  .field-value{font-size:10px;margin-left:10px}
  .version-text{font-size:18px}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:480px){
  .navigation-menu{padding:15px}
  .menu-header{margin-bottom:30px}
  .menu-header .logo{width:60px;height:60px;margin:0 auto 15px}
  .menu-items{gap:10px;max-width:300px}
  .menu-item{padding:15px 20px;font-size:14px}
}

@media (max-width:360px){
  .navigation-menu{padding:10px}
  .menu-header{margin-bottom:25px}
  .menu-header .logo{width:50px;height:50px;margin:0 auto 12px}
  .menu-items{gap:8px;max-width:280px}
  .menu-item{padding:12px 18px;font-size:13px}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è footer –∏ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:480px){
  .footer{margin-top:20px}
  .status{font-size:1em;margin:15px 0}
  #pwa-indicator{font-size:0.75em;margin-top:8px}
}

@media (max-width:360px){
  .footer{margin-top:15px}
  .status{font-size:0.9em;margin:12px 0}
  #pwa-indicator{font-size:0.7em;margin-top:6px}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –æ—à–∏–±–æ–∫ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:480px){
  .error{padding:12px;margin:12px 0;font-size:0.9em}
}

@media (max-width:360px){
  .error{padding:10px;margin:10px 0;font-size:0.85em}
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width:480px){
  .loading-overlay{padding:20px}
  .loading-text{font-size:13px;margin-top:8px}
}

@media (max-width:360px){
  .loading-overlay{padding:15px}
  .loading-text{font-size:12px;margin-top:6px}
}
        </style>
    </head>
    <body>
        <div class="container">
            <div class="scanner-wrapper">
                <div class="scanner-container" id="scannerRoot">
                    <div class="scanner-frame">
                        <div class="scanner-line"></div>
                    </div>
                    <div id="scannerStatus" class="scan-status" style="display:none;">üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...</div>
                </div>
                <div class="control-panel">
                    <div class="d-flex flex-column align-items-center gap-md-1 gap-lg-3">
                        <button class="logo-btn logo" style="width: 130px; height: 120px;" id="logoBtn">
                            <img src="scannerlogo.png" alt="Logo">
                        </button>
                        <div class="zoom-controls">
                            <div class="zoom-buttons">
                                <button
                                    class="btn btn-outline-secondary btn-hover"
                                    style="width: 130px; height: 50px;"
                                    id="zoomMinus"
                                    disabled
                                >‚àí</button>
                                <button
                                    class="btn btn-outline-secondary btn-hover"
                                    style="width: 130px; height: 50px;"
                                    id="zoomPlus"
                                    disabled
                                >+</button>
                            </div>
                        </div>
                        <button id="startBtn" class="btn btn-success" style="width: 130px; height: 50px;">–ø—É—Å–∫</button>
                        <button
                            id="stopBtn"
                            class="btn btn-secondary"
                            style="width: 130px; height: 50px;"
                            disabled
                        >—Å—Ç–æ–ø</button>
                    </div>
                </div>
            </div>
            <div class="result">
                <div class="result-fields">
                    <div class="result-field">
                        <span class="field-label">–®—Ç—Ä–∏—Ö-–∫–æ–¥:</span>
                        <span class="field-value" id="barcodeValue"></span>
                    </div>
                    <div class="result-field">
                        <span class="field-label">–û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ:</span>
                        <span class="field-value" id="designationValue">‚Äî</span>
                    </div>
                    <div class="result-field">
                        <span class="field-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:</span>
                        <span class="field-value" id="nameValue">‚Äî</span>
                    </div>
                    <div class="result-field">
                        <span class="field-label">–ê–≤—Ç–æ—Ä:</span>
                        <span class="field-value" id="authorValue">‚Äî</span>
                    </div>
                    <div class="result-field">
                        <span class="field-label">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</span>
                        <span class="field-value" id="dateValue">‚Äî</span>
                    </div>
                </div>
                <div id="versionIndicator" class="version-text" style="display: none;">–í–µ—Ä—Å–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞</div>
                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="loading-text">–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...</div>
                </div>
            </div>
            <div id="error" class="error" style="display:none"></div>
            <!-- –ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <div id="navigationMenu" class="navigation-menu" style="display: none;">
                <div class="menu-header">
                    <button class="logo logo-btn" id="menuLogoBtn">
                        <img src="scannerlogo.png" alt="Logo">
                    </button>
                </div>
                <div class="menu-items">
                    <button class="menu-item menu-item-scan">üì± –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –®–ö</button>
                    <button class="menu-item menu-item-manual">‚úèÔ∏è –í–≤–æ–¥ –®–ö –≤—Ä—É—á–Ω—É—é</button>
                    <button class="menu-item menu-item-auth">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</button>
                    <button class="menu-item menu-item-list">üìã –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö –®–ö</button>
                    <button class="menu-item menu-item-support">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</button>
                    <button class="menu-item menu-item-info">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                </div>
            </div>
            <div class="footer">
                <div class="status" id="status">–ö–∞–º–µ—Ä–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</div>
                <div id="pwa-indicator" style="margin-top:10px;font-size:.8em;color:#666;"></div>
            </div>
        </div>
        <!-- ZXing-CPP (WASM) -->
        <script src="https://cdn.jsdelivr.net/npm/zxing-wasm@2/dist/iife/reader/index.js"></script>
        <!-- Quagga2 –∫–∞–∫ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–ª–±—ç–∫ -->
        <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.1/dist/quagga.min.js"></script>
        <script>
// PWA –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
function enableFullscreen() {
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen();
  } else if (document.documentElement.webkitRequestFullscreen) {
    document.documentElement.webkitRequestFullscreen();
  } else if (document.documentElement.msRequestFullscreen) {
    document.documentElement.msRequestFullscreen();
  }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –¥–ª—è PWA
if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(enableFullscreen, 1000);
  });
}

// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ Android
function optimizeForAndroid() {
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
  const isAndroid = /Android/i.test(navigator.userAgent);
  const isChrome = /Chrome/i.test(navigator.userAgent);
  const isWebView = /wv/i.test(navigator.userAgent);
  
  if (isAndroid) {
    console.log('Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, –ø—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏...');
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–ª—è –ª–æ–≥–æ—Ç–∏–ø–∞
    const logoElements = document.querySelectorAll('.control-panel .logo, .control-panel .logo img');
    logoElements.forEach(element => {
      element.style.webkitTransform = 'translate3d(0,0,0)';
      element.style.transform = 'translate3d(0,0,0)';
      element.style.webkitBackfaceVisibility = 'hidden';
      element.style.backfaceVisibility = 'hidden';
      element.style.webkitPerspective = '1000px';
      element.style.perspective = '1000px';
    });
    
    // –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ Android
    if (isChrome || isWebView) {
      const images = document.querySelectorAll('.control-panel .logo img');
      images.forEach(img => {
        img.style.imageRendering = 'crisp-edges';
        img.style.webkitImageRendering = 'crisp-edges';
        img.style.imageRendering = 'pixelated';
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–µ—Ç–∫–æ—Å—Ç–∏
        img.style.webkitFilter = 'contrast(1.1) brightness(1.05) saturate(1.1)';
        img.style.filter = 'contrast(1.1) brightness(1.05) saturate(1.1)';
      });
    }
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Android WebView
    if (isWebView) {
      document.body.style.webkitFontSmoothing = 'antialiased';
      document.body.style.mozOsxFontSmoothing = 'grayscale';
    }
  }
}

class BarcodeScanner {
  constructor(){
    this.startBtn = document.getElementById("startBtn");
    this.stopBtn = document.getElementById("stopBtn");
    this.resultText = document.getElementById("resultText");
    this.status = document.getElementById("status");
    this.error = document.getElementById("error");
    this.scannerRoot = document.getElementById("scannerRoot");
    this.frameEl = document.querySelector(".scanner-frame");

    this.isScanning = false;
    this.engine = null; // 'native' | 'zxing' | 'quagga'
    this.videoEl = null;
    this.mediaStream = null;
    this.videoTrack = null;
    this.zoomControls = null;
    this.currentZoom = 1;

    // –∞–Ω—Ç–∏-–¥—Ä–µ–±–µ–∑–≥
    this.lastCode = null;
    this.candidate = null;
    this.candidateCount = 0;
    this.candidateFirstAt = 0;
    this.lockedUntil = 0;
    this.EMIT_STABLE_FRAMES = 4;
    this.EMIT_STABLE_SAME_MS = 400;
    this.EMIT_COOLDOWN_MS = 1200;
    this.PROCESSING_TIME_MS = 2500; // –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

    this.noDetectionTimer = null;
    this.NO_DETECTION_MS = 8000;
    this.isProcessing = false; // –§–ª–∞–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

    this._rafId = 0;

    this.startScanner = this.startScanner.bind(this);
    this.stopScanner = this.stopScanner.bind(this);
    this._onResize = this._onResize.bind(this);
    this.toggleMenu = this.toggleMenu.bind(this);
  }

  initialize(){
    this.startBtn.addEventListener("click", this.startScanner);
    this.stopBtn.addEventListener("click", this.stopScanner);
    window.addEventListener("resize", this._onResize);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ–º
    this.zoomControls = document.querySelector('.zoom-controls');
    this._setupZoomControls();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ª–æ–≥–æ—Ç–∏–ø–∞
    const logoBtn = document.getElementById('logoBtn');
    const menuLogoBtn = document.getElementById('menuLogoBtn');
    if (logoBtn) logoBtn.addEventListener('click', this.toggleMenu);
    if (menuLogoBtn) menuLogoBtn.addEventListener('click', this.toggleMenu);
  }

  async startScanner(){
    this._showError("");
    this.status.textContent = "–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...";
    try{
      if (await this._canUseNative()) {
        await this._startCamera();
        this.engine = 'native';
        this._scanNative();
      } else if (window.ZXingWASM) {
        await this._startCamera();
        this.engine = 'zxing';
        await ZXingWASM.readBarcodes(new ImageData(1,1), { formats: ["Code39"] }); // –ø—Ä–æ–≥—Ä–µ–≤
        this._scanZXing();
      } else {
        await this._startQuagga();
        this.engine = 'quagga';
      }

      this.isScanning = true;
      this.startBtn.disabled = true;
      this.startBtn.classList.remove('btn-success');
      this.startBtn.classList.add('btn-secondary');
      this.stopBtn.disabled = false;
      this.stopBtn.classList.remove('btn-secondary');
      this.stopBtn.classList.add('btn-danger');
      this.status.textContent = "–°–∫–∞–Ω–µ—Ä –≥–æ—Ç–æ–≤! –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥ ScannerOGP (1√ó)";
      this.frameEl.style.display = "block";
      
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (this.zoomControls) {
          // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ zoom
          this._disableZoomControls();
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã
          setTimeout(() => {
            if (this._checkZoomSupport()) {
              // –ö–Ω–æ–ø–∫–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ _checkZoomSupport
            } else {
              // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å, –µ—Å–ª–∏ zoom –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
              if (this.status.textContent.includes('(1√ó)')) {
                this.status.textContent = "–°–∫–∞–Ω–µ—Ä –≥–æ—Ç–æ–≤! –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥ ScannerOGP";
              }
            }
          }, 800);
        }
      
      this._resetNoDetectionTimer();
    } catch(e){
      this._handleError("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: " + (e?.message || e));
    }
  }

  async _canUseNative(){
    if (!('BarcodeDetector' in window)) return false;
    try{
      const formats = await BarcodeDetector.getSupportedFormats();
      return formats.includes('code_39');
    }catch{ return false; }
  }

  async _startCamera(){
    if (!this.videoEl){
      this.videoEl = document.createElement("video");
      this.videoEl.setAttribute("playsinline","true");
      this.videoEl.autoplay = true;
      this.videoEl.muted = true;
      this.scannerRoot.appendChild(this.videoEl);
    }
    this.mediaStream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: { ideal: "environment" },
        width: { ideal: 1920 }, height: { ideal: 1080 },
        advanced: [{ focusMode: "continuous" }]
      },
      audio: false
    });
    this.videoEl.srcObject = this.mediaStream;
    this.videoTrack = this.mediaStream.getVideoTracks()[0] || null;
    await this._applyAutoFocus();
  }

  // ======= Native (BarcodeDetector) =======
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π API –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  async _scanNative(){
    const detector = new BarcodeDetector({ formats: ['code_39'] });
    const loop = async ()=>{
      if (!this.isScanning || this.engine!=='native') return;
      try{
        const res = await detector.detect(this.videoEl);
        if (res && res.length) this._onCandidate(res[0].rawValue);
      }catch{}
      this._resetNoDetectionTimer();
      this._rafId = requestAnimationFrame(loop);
    };
    this._rafId = requestAnimationFrame(loop);
  }

  // ======= ZXing-WASM =======
  // Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ BarcodeDetector
  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∂–µ—Å—Ç—ã –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
  async _scanZXing(){
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    const opts = {
      formats: ["Code39"],
      tryHarder: true,
      tryRotate: true,
      tryInvert: true,
      tryDownscale: true,
      minLineCount: 2,
      maxNumberOfSymbols: 1,
      tryCode39ExtendedMode: true,
      binarizer: "LocalAverage"
    };

    const loop = async ()=>{
      if (!this.isScanning || this.engine!=='zxing') return;
      try{
        const { w, h } = this._drawROIToCanvas(this.videoEl, canvas, ctx);
        const imageData = ctx.getImageData(0,0,w,h);
        const results = await ZXingWASM.readBarcodes(imageData, opts);
        if (results && results.length) this._onCandidate(results[0].text);
      }catch{}
      this._resetNoDetectionTimer();
      this._rafId = requestAnimationFrame(loop);
    };
    this._rafId = requestAnimationFrame(loop);
  }

  _drawROIToCanvas(video, canvas, ctx){
    const vr = video.getBoundingClientRect();
    const fr = this.frameEl.getBoundingClientRect();
    const sx = Math.max(0, (fr.left - vr.left) / vr.width  * video.videoWidth);
    const sy = Math.max(0, (fr.top  - vr.top ) / vr.height * video.videoHeight);
    const sw = Math.min(video.videoWidth  - sx, fr.width  / vr.width  * video.videoWidth);
    const sh = Math.min(video.videoHeight - sy, fr.height / vr.height * video.videoHeight);
    const w = Math.max(360, Math.floor(sw));
    const h = Math.max(160, Math.floor(sh));
    canvas.width = w; canvas.height = h;
    ctx.drawImage(video, sx, sy, sw, sh, 0, 0, w, h);
    return { w, h };
  }

  // ======= Quagga2 (fallback) =======
  async _startQuagga(){
    return new Promise((resolve,reject)=>{
      try{ Quagga.offDetected?.(()=>{}); }catch(_){}
      const area = this._computeROI();
      const constraints = {
        facingMode: { ideal: "environment" },
        width:{ideal:1920}, height:{ideal:1080},
        advanced:[{ focusMode: "continuous" }]
      };
      Quagga.init({
        inputStream:{ name:"Live", type:"LiveStream", target:this.scannerRoot, constraints, area },
        locator:{ patchSize:"x-small", halfSample:false },
        decoder:{ readers:["code_39_reader"], multiple:false },
        locate:true,
        numOfWorkers: navigator.hardwareConcurrency || 4,
        frequency: 25
      }, (err)=>{
        if (err) return reject(err);
        Quagga.onDetected((res)=>{
          const code = res?.codeResult?.code;
          if (code) this._onCandidate(code);
          this._resetNoDetectionTimer();
        });
        Quagga.start();

        setTimeout(async ()=>{
          const v = this.scannerRoot.querySelector("video");
          if (v){ v.setAttribute("playsinline",""); v.muted = true; v.autoplay = true; }
          this.videoEl = v;
          this.mediaStream = v?.srcObject || null;
          this.videoTrack = this.mediaStream?.getVideoTracks?.()[0] || null;
          await this._applyAutoFocus();
        }, 300);

        this._resetNoDetectionTimer();
        resolve();
      });
    });
  }

  _computeROI(){
    const r = this.scannerRoot.getBoundingClientRect();
    const f = this.frameEl.getBoundingClientRect();
    const top = Math.max(0, (f.top - r.top)/r.height*100);
    const left= Math.max(0, (f.left- r.left)/r.width *100);
    const right = Math.max(0, 100 - (f.right - r.left)/r.width *100);
    const bottom= Math.max(0, 100 - (f.bottom- r.top )/r.height*100);
    return { top:`${top}%`, right:`${right}%`, left:`${left}%`, bottom:`${bottom}%` };
  }

  _onCandidate(raw){
    const now = performance.now();
    if (now < this.lockedUntil || this.isProcessing) return; // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

    let code = (raw || "").trim().replace(/^\*|\*$/g, "");
    if (!code) return;

    if (this.candidate === code){
      this.candidateCount++;
    } else {
      this.candidate = code;
      this.candidateCount = 1;
      this.candidateFirstAt = now;
    }

    const longEnough = (now - this.candidateFirstAt) >= this.EMIT_STABLE_SAME_MS;
    if (this.candidateCount >= this.EMIT_STABLE_FRAMES && longEnough){
      this._emitFinal(code);
    }
  }

  _emitFinal(code){
    this.lastCode = code;
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    this.isProcessing = true;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    this._showLoadingOverlay();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
    const barcodeValue = document.getElementById('barcodeValue');
    if (barcodeValue) {
      barcodeValue.textContent = code;
    }
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
    this._fillResultFields(code);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –≤–µ—Ä—Å–∏–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ä–∞–º–∫–∏
    this._checkVersionAndUpdateUI(code);
    
    this.status.textContent = `–ì–æ—Ç–æ–≤–æ: ${code} (${this.currentZoom}√ó)`;
    this._flashFrame(true);
    this._beep();
    setTimeout(()=> this._flashFrame(false), 900);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏
    setTimeout(() => {
      this._hideLoadingOverlay();
      this.isProcessing = false;
    }, this.PROCESSING_TIME_MS);
    
    this.lockedUntil = performance.now() + this.EMIT_COOLDOWN_MS;
    this.candidate = null;
    this.candidateCount = 0;
    this.candidateFirstAt = 0;
  }

  async _applyAutoFocus(){
    if (!this.videoTrack?.getCapabilities) return;
    const caps = this.videoTrack.getCapabilities();
    const adv = [];
    
    // –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ñ–æ–∫—É—Å - —É–±–∏—Ä–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∞–º–∏ –≤—ã–±–µ—Ä—É—Ç –Ω—É–∂–Ω–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
    if (caps.focusMode?.includes?.("continuous")) {
      adv.push({ focusMode: "continuous" });
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ–∫—É—Å–∞
    if (adv.length > 0) {
      try {
        await this.videoTrack.applyConstraints({ advanced: adv });
      } catch (e) {
        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ—Ñ–æ–∫—É—Å:', e);
      }
    }
  }

  _setupZoomControls(){
    if (!this.zoomControls) return;
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ + –∏ - (–ø—Ä–æ–≤–µ—Ä–∫–∞ zoom –±—É–¥–µ—Ç –ø–æ–∑–∂–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–∞–º–µ—Ä—ã)
    const zoomPlus = document.getElementById('zoomPlus');
    const zoomMinus = document.getElementById('zoomMinus');
    
    if (zoomPlus && zoomMinus) {
      zoomPlus.addEventListener('click', () => this._stepZoom(1));
      zoomMinus.addEventListener('click', () => this._stepZoom(-1));
    }
  }

  _checkZoomSupport(){
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–∞–º–µ—Ä—ã
    if (this.videoTrack?.getCapabilities) {
      const caps = this.videoTrack.getCapabilities();
      
      // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –∫–∞–º–µ—Ä—ã
      console.log('–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞–º–µ—Ä—ã:', {
        zoom: caps.zoom,
        focusMode: caps.focusMode,
        torch: caps.torch
      });
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ
      if (!caps.zoom || caps.zoom.min === caps.zoom.max || caps.zoom.max <= 1.1) {
        console.log('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ');
        this._disableZoomControls();
        return false;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è zoom
      const min = Math.ceil(caps.zoom.min ?? 1);
      const max = Math.floor(caps.zoom.max ?? 1);
      
      console.log(`–î–æ—Å—Ç—É–ø–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω zoom: ${min}x - ${max}x`);
      
      // –ï—Å–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –º–µ–Ω—å—à–µ 1.3, —Ç–æ zoom –Ω–µ –Ω—É–∂–µ–Ω
      // (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ–±-–∫–∞–º–µ—Ä—ã –∏–º–µ—é—Ç –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω)
      if (max < 1.3) {
        console.log('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ, zoom –Ω–µ –Ω—É–∂–µ–Ω');
        this._disableZoomControls();
        return false;
      }
      
      console.log('–ö–Ω–æ–ø–∫–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã');
      this._enableZoomControls();
      return true;
    }
    
    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞–º–µ—Ä—ã');
    this._disableZoomControls();
    return false;
  }

  async _applyZoom(zoom){
    if (!this.videoTrack?.getCapabilities) return;
    
    try {
      const caps = this.videoTrack.getCapabilities();
      if (!caps.zoom) return;
      
      const min = caps.zoom.min ?? 1;
      const max = caps.zoom.max ?? 1;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
      const clampedZoom = Math.max(min, Math.min(max, zoom));
      
      await this.videoTrack.applyConstraints({
        advanced: [{ zoom: clampedZoom }]
      });
      
      this.currentZoom = clampedZoom;
      console.log(`–ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${clampedZoom}x`);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏
      if (this.status.textContent.includes('–ì–æ—Ç–æ–≤–æ:')) {
        this.status.textContent = `–ì–æ—Ç–æ–≤–æ: ${this.lastCode} (${clampedZoom}√ó)`;
      }
      
      // –ö–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è
      this._beepShort();
      
    } catch (e) {
      console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ:', e);
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      this._handleError(`–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ ${zoom}√ó`);
    }
  }

  _enableZoomControls(){
    // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ zoom
    if (this.zoomControls) {
      const zoomMinus = document.getElementById('zoomMinus');
      const zoomPlus = document.getElementById('zoomPlus');
      if (zoomMinus && zoomPlus) {
        zoomMinus.disabled = false;
        zoomPlus.disabled = false;
        zoomMinus.classList.remove('btn-outline-secondary');
        zoomMinus.classList.add('btn-outline-primary');
        zoomPlus.classList.remove('btn-outline-secondary');
        zoomPlus.classList.add('btn-outline-primary');
      }
    }
  }

  _disableZoomControls(){
    // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ zoom
    if (this.zoomControls) {
      const zoomMinus = document.getElementById('zoomMinus');
      const zoomPlus = document.getElementById('zoomPlus');
      if (zoomMinus && zoomPlus) {
        zoomMinus.disabled = true;
        zoomPlus.disabled = true;
        zoomMinus.classList.remove('btn-outline-primary');
        zoomMinus.classList.add('btn-outline-secondary');
        zoomPlus.classList.remove('btn-outline-primary');
        zoomPlus.classList.add('btn-outline-secondary');
      }
    }
  }

  _stepZoom(step){
    if (!this.videoTrack?.getCapabilities) return;
    
    const caps = this.videoTrack.getCapabilities();
    if (!caps.zoom) return;
    
    const min = Math.ceil(caps.zoom.min ?? 1);
    const max = Math.floor(caps.zoom.max ?? 1);
    
    // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–µ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑—É–º–∞
    const availableZooms = [1, 2, 3, 4, 5].filter(z => z >= min && z <= max);
    if (availableZooms.length === 0) return;
    
    const currentIndex = availableZooms.indexOf(this.currentZoom);
    let newIndex;
    
    if (step > 0) {
      // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑—É–º
      newIndex = Math.min(currentIndex + 1, availableZooms.length - 1);
    } else {
      // –£–º–µ–Ω—å—à–∞–µ–º –∑—É–º
      newIndex = Math.max(currentIndex - 1, 0);
    }
    
    const newZoom = availableZooms[newIndex];
    if (newZoom !== this.currentZoom) {
      // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ
      this._applyZoom(newZoom);
    }
  }

  _checkVersionAndUpdateUI(code){
    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
    const resultElement = document.querySelector('.result');
    const versionIndicator = document.getElementById('versionIndicator');
    
    if (!resultElement || !versionIndicator) return;
    
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–∏
    // –ü–æ–∫–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ –¥–ª–∏–Ω–µ –∫–æ–¥–∞
    const isActual = code.length >= 5; // –ü—Ä–∏–º–µ—Ä: –∫–æ–¥ –¥–ª–∏–Ω–æ–π 5+ —Å–∏–º–≤–æ–ª–æ–≤ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º
    
    if (isActual) {
      // –í–µ—Ä—Å–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ - –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç —Ä–∞–º–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
      resultElement.classList.add('actual');
      versionIndicator.style.display = 'block';
    } else {
      // –í–µ—Ä—Å–∏—è –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞ - –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç —Ä–∞–º–∫–∏ –∏ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
      resultElement.classList.remove('actual');
      versionIndicator.style.display = 'none';
    }
  }

  _fillResultFields(code){
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
    const designationValue = document.getElementById('designationValue');
    const nameValue = document.getElementById('nameValue');
    const authorValue = document.getElementById('authorValue');
    const dateValue = document.getElementById('dateValue');
    
    if (designationValue) designationValue.textContent = '073–î-–ü-–≠–≠';
    if (nameValue) nameValue.textContent = '–¢–µ–∫—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å';
    if (authorValue) authorValue.textContent = '–ß–µ—Ä–Ω–æ–≤ –Æ—Ä–∏–π';
    if (dateValue) dateValue.textContent = '10.26.2015 16:39:23';
  }

  _clearResultFields(){
    // –û—á–∏—â–∞–µ–º –≤—Å–µ –ø–æ–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    const barcodeValue = document.getElementById('barcodeValue');
    const designationValue = document.getElementById('designationValue');
    const nameValue = document.getElementById('nameValue');
    const authorValue = document.getElementById('authorValue');
    const dateValue = document.getElementById('dateValue');
    
    if (barcodeValue) barcodeValue.textContent = ' ';
    if (designationValue) designationValue.textContent = '‚Äî';
    if (nameValue) nameValue.textContent = '‚Äî';
    if (authorValue) authorValue.textContent = '‚Äî';
    if (dateValue) dateValue.textContent = '‚Äî';
  }

  _showLoadingOverlay(){
    const loadingOverlay = document.getElementById('loadingOverlay');
    if (loadingOverlay) {
      loadingOverlay.style.display = 'flex';
    }
  }

  _hideLoadingOverlay(){
    const loadingOverlay = document.getElementById('loadingOverlay');
    if (loadingOverlay) {
      loadingOverlay.style.display = 'none';
    }
  }

  toggleMenu(){
    const menu = document.getElementById('navigationMenu');
    if (menu) {
      if (menu.style.display === 'none') {
        menu.style.display = 'flex';
        menu.style.opacity = '0';
        menu.style.transform = 'scale(0.9)';
        setTimeout(() => {
          menu.style.opacity = '1';
          menu.style.transform = 'scale(1)';
        }, 10);
      } else {
        menu.style.opacity = '0';
        menu.style.transform = 'scale(0.9)';
        setTimeout(() => {
          menu.style.display = 'none';
        }, 200);
      }
    }
  }



  _onResize(){
    if (!this.isScanning) return;
    if (this.engine === 'quagga'){
      Quagga.stop?.(); this._startQuagga().catch(()=>{});
    }
  }

  async stopScanner(){
    this.isScanning = false;
    this.startBtn.disabled = false;
    this.startBtn.classList.remove('btn-secondary');
    this.startBtn.classList.add('btn-success');
    this.stopBtn.disabled = true;
    this.stopBtn.classList.remove('btn-danger');
    this.stopBtn.classList.add('btn-secondary');
    this.status.textContent = "–ö–∞–º–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞";
    this._showError(""); this._flashFrame(false);
    
    // –û—Ç–∫–ª—é—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ–º
    if (this.zoomControls) {
      this._disableZoomControls();
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ
    this.currentZoom = 1;
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    this.isProcessing = false;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    this._hideLoadingOverlay();
    
    // –û—á–∏—â–∞–µ–º –≤—Å–µ –ø–æ–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    this._clearResultFields();
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ü–≤–µ—Ç —Ä–∞–º–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    const resultElement = document.querySelector('.result');
    if (resultElement) {
      resultElement.classList.remove('actual');
    }
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–µ—Ä—Å–∏–∏
    const versionIndicator = document.getElementById('versionIndicator');
    if (versionIndicator) {
      versionIndicator.style.display = 'none';
    }
    
    cancelAnimationFrame(this._rafId);
    clearTimeout(this.noDetectionTimer);

    try{ Quagga.offDetected?.(()=>{}); Quagga.stop?.(); }catch(_){}
    try{ this.mediaStream?.getTracks?.().forEach(t=>t.stop()); }catch(_){}
    this.engine = null;
  }

  _resetNoDetectionTimer(){
    clearTimeout(this.noDetectionTimer);
    this.noDetectionTimer = setTimeout(()=>{
      this._handleError("–ù–µ —É–¥–∞—ë—Ç—Å—è —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —à—Ç—Ä–∏—Ö-–∫–æ–¥. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ/—Ä–µ–∑–∫–æ—Å—Ç—å.");
    }, this.NO_DETECTION_MS);
  }

  _flashFrame(ok){ if (this.frameEl) this.frameEl.style.borderColor = ok ? "lime" : "#ff6b35"; }
  _handleError(msg){ this.error.textContent = msg; this.error.style.display="block"; this.status.textContent="–û—à–∏–±–∫–∞"; }
  _showError(msg){ this.error.style.display = msg ? "block" : "none"; this.error.textContent = msg; }

  _beep(){
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type="square"; o.frequency.setValueAtTime(880, ctx.currentTime);
      g.gain.setValueAtTime(0.001, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.15);
      o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.16);
      setTimeout(()=>ctx.close?.(), 250);
    }catch(_){}
  }

  _beepShort(){
    try{
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.type="sine"; o.frequency.setValueAtTime(660, ctx.currentTime);
      g.gain.setValueAtTime(0.001, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.1, ctx.currentTime+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.08);
      o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.09);
      setTimeout(()=>ctx.close?.(), 150);
    }catch(_){}
  }
}


document.addEventListener("DOMContentLoaded", ()=> {
  new BarcodeScanner().initialize();
  optimizeForAndroid(); // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è Android
});

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker (–û–ë–ù–û–í–õ–ï–ù–ê: –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å, –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const swUrl = new URL('./sw.js', location.href).toString();
      const reg = await navigator.serviceWorker.register(swUrl, { scope: './' });

      reg.update?.();

      if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });

      reg.addEventListener('updatefound', () => {
        const nw = reg.installing;
        if (!nw) return;
        nw.addEventListener('statechange', () => {
          if (nw.state === 'installed' && navigator.serviceWorker.controller) {
            nw.postMessage({ type: 'SKIP_WAITING' });
          }
        });
      });

      let reloaded = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (reloaded) return;
        reloaded = true;
        location.reload();
      });

      updatePWAIndicator('‚úÖ PWA –∞–∫—Ç–∏–≤–µ–Ω - —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω');
    } catch (e) {
      console.log('SW register error', e);
      updatePWAIndicator('‚ö†Ô∏è PWA –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω');
    }
  });
}

function updatePWAIndicator(m){ const el = document.getElementById('pwa-indicator'); if (el) el.innerHTML = m; }
function checkPWAStatus(){
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistration().then(reg => {
      updatePWAIndicator(reg?.active ? '‚úÖ PWA –∞–∫—Ç–∏–≤–µ–Ω - —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω' : '‚è≥ PWA –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
    });
  } else updatePWAIndicator('‚ùå PWA –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
}
document.addEventListener('DOMContentLoaded', checkPWAStatus);
        </script>
    </body>
</html>
